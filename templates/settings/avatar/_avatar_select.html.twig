<div class="avatar avatar-xl mt-n4 me-1">
    <div class="dropdown">
        <a class="d-flex flex-column justify-content-end position-relative overflow-hidden rounded-circle bg-position-center flex-shrink-0"
           id="dropdownAvatarSelector"
           href="#"
           aria-expanded="false"
           style="width: 80px;
                   height: 80px;
                   margin-top: 7px;
                   background-image:url({{ asset('uploads/avatar/' ~ app.user.avatar ?? 'placeholder.jpg') }});
                   background-size: cover;
                   background-repeat: no-repeat;">
            <span id="avatarSelector" class="badge text-center"
                  style="background-color: rgba(0, 0, 0, 0.5)">
                <i class="fa-solid fa-camera"></i>
            </span>
        </a>

        <ul class="dropdown-menu my-1" style="width: 350px; display: none;" id="avatarDropdownMenu">
            <li>
                <span class="dropdown-item fw-normal">
                    <fieldset id="avatarForm">
                        {{ form_start(formAvatar) }}
                            <div class="d-flex justify-content-between align-items-center">
                                <i class="ai-camera fs-base opacity-70 me-2"></i>
                                {{ form_widget(formAvatar.avatarFile, {
                                    'attr': {'class': 'form-control form-control-sm'}
                                }) }}
                            </div>
                            <div class="form-errors">
                                {{ form_errors(formAvatar.avatarFile) }}
                            </div>
                            <div class="d-flex justify-content-between mt-2">
                                <button class="btn btn-sm btn-success ms-2" type="submit">
                                    <span>Sauvegarder</span>
                                </button>
                                <a class="dropdown-item text-danger fw-normal text-end"
                                   href="{{ path('profile_settings.delete_avatar', {'id': app.user.id}) }}">
                                    <i class="ai-trash fs-base me-2"></i>
                                    Effacer l'avatar
                                </a>
                            </div>
                        {{ form_end(formAvatar) }}
                    </fieldset>
                </span>
            </li>
        </ul>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const avatarSelector = document.getElementById("dropdownAvatarSelector");
        const avatarDropdownMenu = document.getElementById("avatarDropdownMenu");

        avatarSelector.addEventListener("click", () => {
            if (avatarDropdownMenu.style.display === "block") {
                avatarDropdownMenu.style.display = "none";
            } else {
                avatarDropdownMenu.style.display = "block";
            }
        });
    });
</script>
